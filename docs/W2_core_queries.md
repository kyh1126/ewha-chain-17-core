# W2 핵심 쿼리 가이드

**기간**: 3월 2주  
**목표**: 핵심 지표 쿼리 3~4개 확정 + SQL 재현성 확보 + Looker Studio 연동 시작

## 📋 W2 체크리스트

- [ ] 표준 지표 쿼리 템플릿 3~4개 함께 읽고 실행
- [ ] 각 쿼리 "왜 이렇게 썼는지" 이해
- [ ] Looker Studio 연동 방법 데모 참여
- [ ] 템플릿 기반 "나만의 지표 1개" 쿼리 작성
- [ ] Looker Studio에 차트 1개 이상 추가
- [ ] 막히면 팀 커뮤니케이션 채널에 질문 (24시간 내 답변 목표)

## 1. 표준 지표 쿼리 템플릿 (팀장 준비물)

다음 템플릿은 **코드 리뷰 세션**에서 함께 읽고 실행합니다.

### 1.1 사용할 템플릿 목록

| 파일 | 지표 | 설명 |
|------|------|------|
| `templates/queries/01_tx_volume.sql` | 거래량 추이 | TPS 유사 지표, 시간 버킷별 tx count |
| `templates/queries/02_active_addresses.sql` | 활성 주소·프로그램 Top N | 일별 활성 주소, 컨트랙트/프로그램 활동 |
| `templates/queries/03_fee_gas.sql` | 수수료/가스 지표 | 가용 체인 한정, 일별 수수료·가스비 |
| `templates/queries/04_failed_transactions.sql` | 실패/리버트 지표 | 실패 트랜잭션 비율 등 (가용 체인 한정) |

각 쿼리에는 **설명 주석**이 포함되어 있습니다. 실행 전에 주석을 읽고 "왜 이 컬럼/조건을 썼는지" 이해하세요.

> **주의**: 각 SQL 파일에는 Ethereum 쿼리와 Solana 쿼리가 **함께** 들어있습니다.  
> BigQuery 콘솔에서는 **실행할 쿼리 부분만 드래그(선택)한 뒤 "실행" 버튼**을 누르세요.  
> 파일 전체를 한 번에 실행하면 마지막 쿼리의 결과만 표시됩니다.

### 1.2 코드 리뷰 세션 (1시간) 안내

- 쿼리 하나씩 함께 읽고 실행
- 팀장이 "왜 이렇게 썼는지" 설명
- Looker Studio 연동 방법 데모

**세션 전 준비**: 위 4개 템플릿 파일을 미리 열어두고, BigQuery 콘솔에서 한 개씩 실행해 보세요.

## 2. 표준 지표 쿼리 함께 실행 (개별)

### 2.1 순서대로 실행

1. **`templates/queries/01_tx_volume.sql`**
   - 날짜 범위 확인 (예: 최근 30일)
   - 실행 후 결과 행 수·컬럼 확인
   - `DATE()` / `EXTRACT()` 함수로 일/시간 단위 집계하는 방법 이해

2. **`templates/queries/02_active_addresses.sql`**
   - 체인별(Ethereum: from/to, Solana: accounts 레코드) 활성 주소 정의 확인
   - Top N 값 변경해 보기 (예: 10 → 20)

3. **`templates/queries/03_fee_gas.sql`** (Ethereum 등 가용 시)
   - `receipt_gas_used`, `gas_price` 관계 이해 (transactions 테이블 기준)
   - Solana는 `fee` 컬럼 사용

4. **`templates/queries/04_failed_transactions.sql`** (가용 시)
   - `receipt_status`(Ethereum) 또는 `status`(Solana, STRING 타입) 활용

### 2.2 쿼리 수정·재현성 확인

- 프로젝트/데이터셋 이름이 본인 환경에 맞는지 확인
- 날짜 범위를 바꿔서 다시 실행해 보기
- 결과를 CSV로 저장해 두면 W3·W4에서 Gemini/리포트에 활용 가능

**✅ 확인**: 3~4개 템플릿을 모두 실행했고, 결과가 재현되는지 확인

## 3. Looker Studio 연동

### 3.1 데이터 소스 연결

1. [Looker Studio](https://lookerstudio.google.com/) 접속
2. "만들기" → "데이터 소스"
3. "BigQuery" 커넥터 선택
4. 프로젝트 → 데이터셋 선택
5. **저장된 쿼리** 또는 **커스텀 쿼리**로 템플릿 쿼리 연결

### 3.2 첫 차트 추가

1. "만들기" → "보고서" → 방금 만든 데이터 소스 선택
2. "차트 추가" → 시계열/막대/표 중 선택
3. 날짜 차원 + 지표(예: tx_count, active_addresses) 매핑
4. 제목·축 레이블 정리

자세한 단계는 [대시보드 생성 가이드](./guides/dashboard_creation.md) 및 `templates/dashboard/looker_studio_guide.md` 참고.

**✅ 확인**: Looker Studio에 차트 1개 이상 추가 완료

## 4. 나만의 지표 1개 쿼리 작성 (개별 숙제)

### 4.1 요구 사항

- 템플릿 중 하나를 **기반**으로 하되, **본인만의 지표**로 수정
- 예: 기간 변경, 필터 추가, 다른 테이블 JOIN, 체인 비교 등

### 4.2 작성 후 제출

1. 쿼리 파일을 `members/[본인이름]/queries/` 에 저장
2. 파일명 예: `my_metric_volume_by_hour.sql`
3. 쿼리 상단에 주석으로 목적·지표 정의 작성
4. (선택) Looker Studio에 이 쿼리 기반 차트 추가 후 스크린샷

### 4.3 코드 리뷰

- PR 생성 시 팀장/동료가 코드 리뷰
- "왜 이 지표를 선택했는지", "쿼리 로직" 간단히 설명 추가 권장

**✅ 확인**: 나만의 지표 1개 쿼리 작성 + (가능 시) Looker 차트 1개

## 5. 자주 묻는 질문 (W2)

**Q: 템플릿을 거의 그대로 써도 되나요?**  
A: 지표 정의(날짜 범위, 필터, 집계 단위)를 본인 분석 목적에 맞게 반드시 수정하세요. 그대로 복사만 하면 "나만의 지표"로 인정되지 않습니다.

**Q: Looker Studio에서 쿼리 결과가 안 나와요.**  
A: BigQuery에서 먼저 쿼리가 성공하는지 확인하세요. 데이터 소스에서 "커스텀 쿼리"를 사용할 경우, 쿼리 문법과 프로젝트 ID가 맞는지 확인하세요.

**Q: 복잡한 JOIN 쿼리를 도전해도 되나요?**  
A: 네. 빠르게 진행하는 사람은 추가 챌린지로 복잡한 JOIN 쿼리 작성 권장합니다. 막히면 팀 커뮤니케이션 채널에 질문하세요.

**Q: 느린 사람은 어떻게 하면 되나요?**  
A: 1:1 멘토링 시간을 요청할 수 있습니다. 주간 체크인 미팅(30분)에서 어려운 부분을 공유해 주세요.

## 6. W2 마무리 체크리스트

- [ ] 표준 지표 쿼리 3~4개 실행 및 이해
- [ ] Looker Studio 데이터 소스 연결 + 차트 1개 이상
- [ ] 나만의 지표 1개 쿼리 작성 및 `members/[본인이름]/queries/` 저장
- [ ] (선택) PR 생성 및 코드 리뷰 요청
- [ ] 팀 커뮤니케이션 채널에서 질문·피드백 확인

## 7. 다음 주 (W3) 준비

W3에서는 다음을 진행합니다:

- 대시보드 1차 완성
- Gemini API 연동 (주간 요약 / 이상징후 코멘트)
- 프롬프트 커스터마이징

W2에서 만든 차트와 쿼리 결과를 정리해 두면, W3에서 Gemini로 "요약 생성"할 때 바로 활용할 수 있습니다.

## 8. 관련 문서

- [W1 온보딩 가이드](./W1_onboarding.md)
- [쿼리 실행 가이드](./guides/query_execution.md)
- [대시보드 생성 가이드](./guides/dashboard_creation.md)
- [데이터셋 스키마](./onboarding/02_dataset_schema.md)
- [FAQ](./FAQ.md)
