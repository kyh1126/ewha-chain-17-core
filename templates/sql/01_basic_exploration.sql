-- ============================================
-- 샘플 쿼리 01: 기본 데이터 탐색
-- ============================================
-- 목적: BigQuery에서 온체인 데이터를 처음 접하는 분들을 위한 기본 탐색 쿼리
-- 학습 포인트: SELECT, FROM, WHERE, ORDER BY, LIMIT 기본 문법
-- 실행 시간: 약 5-10초
-- 처리 데이터: 약 1MB (비용 매우 낮음)

-- ============================================
-- 쿼리 설명
-- ============================================
-- 이 쿼리는 Ethereum 네트워크의 최근 블록 정보를 조회합니다.
-- 블록 번호, 타임스탬프, 트랜잭션 개수 등 기본 정보를 확인할 수 있습니다.

SELECT
  -- 블록 번호 (가장 최근 블록이 가장 큰 번호)
  number AS block_number,
  
  -- 블록이 생성된 시간 (타임스탬프 형식)
  timestamp AS block_timestamp,
  
  -- 이 블록에 포함된 트랜잭션 개수
  transaction_count,
  
  -- 블록에서 사용된 가스량
  gas_used,
  
  -- 블록의 가스 한도
  gas_limit,
  
  -- 가스 사용률 계산 (사용량 / 한도 * 100)
  ROUND(100.0 * gas_used / NULLIF(gas_limit, 0), 2) AS gas_usage_percent

FROM
  -- Ethereum 블록 데이터가 저장된 공개 데이터셋
  `bigquery-public-data.crypto_ethereum.blocks`

WHERE
  -- 최근 7일간의 블록만 조회 (비용 절감)
  timestamp >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 7 DAY)

ORDER BY
  -- 블록 번호 내림차순 정렬 (최신 블록이 위에)
  number DESC

LIMIT
  -- 결과를 10개로 제한 (빠른 확인용)
  10;

-- ============================================
-- 실행 결과 예시
-- ============================================
-- block_number | block_timestamp        | transaction_count | gas_used | gas_limit | gas_usage_percent
-- 18500000     | 2025-03-15 12:34:56   | 150               | 15000000 | 30000000  | 50.00
-- 18499999     | 2025-03-15 12:33:45   | 200               | 20000000 | 30000000  | 66.67
-- ...

-- ============================================
-- 커스터마이징 팁
-- ============================================
-- 1. 기간 변경: INTERVAL 7 DAY → INTERVAL 30 DAY (더 많은 데이터)
-- 2. 정렬 변경: DESC → ASC (오래된 블록부터)
-- 3. 개수 변경: LIMIT 10 → LIMIT 100 (더 많은 결과)
-- 4. 필터 추가: WHERE 절에 gas_used > 20000000 추가 (가스 많이 사용한 블록만)

-- ============================================
-- 다음 단계
-- ============================================
-- 이 쿼리를 이해했다면 다음 쿼리로 넘어가세요:
-- - 02_aggregation.sql: 집계 함수 사용법
-- - 03_join.sql: 여러 테이블 결합 방법
